<!DOCTYPE html []>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="author" content="MarkdownViewer++" />
    <title>php-checking.md</title>
    <style type="text/css">
            
/* Avoid page breaks inside the most common attributes, especially for exports (i.e. PDF) */
td, h1, h2, h3, h4, h5, p, ul, ol, li {
    page-break-inside: avoid; 
}

        </style>
  </head>
  <body>
    <h1 id="phpcodesniffer-phpcompatibility-for-checking-codebase-before-migration">PHPCodeSniffer + PHPCompatibility For Checking Codebase Before Migration</h1>
    <h3 id="published-on-may-10-2017">Published on May 10, 2017</h3>
    <p>As I mentioned yesterday, if you want to use <a href="https://github.com/squizlabs/PHP_CodeSniffer">PHPCodeSniffer</a>+<a href="https://github.com/wimg/PHPCompatibility">PHPCompatibility</a><strong>make sure you are using the 2.9 version of PHPCodeSniffer</strong>.  Failing to see the notice in the <a href="https://github.com/wimg/PHPCompatibility#requirements">PHPCompatibility Requirements section</a> about it being incompatible with PHPCS3.0 will lead to several hours of hair-pulling and cursing at your screen.</p>
    <blockquote>The PHPCompatibility standard is currently not compatible with PHPCS 3.0</blockquote>
If you are unfamiliar with PHPCodeSniffer (PHPCS), it parses your codebase looking for violations a standard(s) (or Sniffers) you've selected.  Additional standards can be added to PHPCS and used to validate code.  PHPCompatibility is an example of a PHPCS standard extension. It allows us to check our codebase for compatibility with higher and lower versions of PHP. PHPCS is available as a phar package which makes it easy to install into our web account for checking our code.
<p><em>Just like yesterday, PHPCS can be installed locally if you would prefer to evaluate your code there instead of on the testing or development environment. macOS and *nix should be able to follow the directions here; windows users will need to either have PHP installed, or look at running a VM with PHP (there are lots of <a href="https://hub.docker.com/search/?isAutomated=0&amp;isOfficial=0&amp;page=1&amp;pullCount=0&amp;q=phpcs&amp;starCount=0">docker options</a> available). </em></p><p>First we need PHPCS. After logging into your account vis SSH, and navigating to your web account space, issue the following:</p><p><code></code></p><p>[bash]curl -OL <a href="https://github.com/squizlabs/PHP_CodeSniffer/releases/download/2.9.0/phpcs.phar%5B/bash%5D">https://github.com/squizlabs/PHP_CodeSniffer/releases/download/2.9.0/phpcs.phar[/bash]</a></p><p> </p><p>Curl should produce a status indicator and notify you when it is finished.  You can test the phar file to make sure it downloaded correctly by running</p><p><code></code></p><p>[bash]php phpcs.phar --version[/bash]</p><p> </p><p>which should output</p><p><code></code></p><p>[bash]PHP_CodeSniffer version 2.9.0 (stable) by Squiz (<a href="http://www.squiz.net">http://www.squiz.net</a>) [/bash]</p><p> </p><p>Now we need to install PHPCompatibility. Unfortunately, it is not available as a phar package so we'll need to clone the the repository. Before we do that we'll need to create a new directory where we'll store all our Standards plugins.  (<em>Technically you don't need to do this, but it comes in handy if you decide later you want to continue to use PHPCS and want to add in more standards beyond PHPCompatibility</em>). For this example, I created a directory <em>extrastandards</em> and navigated into it.  Clone the PHPCompatibility repository:</p><p><code></code></p><p>[bash]git clone https://github.com/wimg/PHPCompatibility.git[/bash]</p><p> </p><p>Which will create the directory <em>PHPCompatibility</em> and place the contents of the repository into it.  Next navigate back to where you stored phpcs.phar. Before we can scan our codebase, we need to tell PHPCS where we are storing the additional standards we want to use.  To let it know our additional standards are in our extrastandards directory, issue the following:</p><p><code></code></p><p>[bash]php phpcs.phar --config-set installed_paths extrastandards [/bash]</p><p> </p><p>PHPCS should report</p><p><code></code></p><p>[bash]Config value "installed_paths" added successfully[/bash]</p><p> </p><p>In addition, you should notice a CodeSniffer.conf file has been created.  (If you ever need to change the standards location, or add to it, you'll need to edit this .conf file).  You can now verify the available standards by doing:</p><p><code></code></p><p>[bash]
php phpcs.phar -i
[/bash]</p><p> </p><p>PHPCS should report that the installed standards includes our PHPCompatibility standard.</p><p><code></code></p><p>[bash] The installed coding standards are MySource, PEAR, PHPCS, PSR1, PSR2, Squiz, Zend and PHPCompatibility [/bash]</p><p> </p><p>We're now ready to start checking our code.  To do so, type in the following:</p><p><code></code></p><p>[bash] php -d date.timezone=America/Chicago phpcs.phar --standard=PHPCompatibility --runtime-set testVersion 7.0 www/wp-contents/plugins/mizzoumvc [/bash]</p><p> </p><p>The <code>-d date.timezone=America/Chicago</code> is there because, for some reason, the timezone is not set in the default php.ini file (which is what PHP will use when running from the command line) on our web servers. This simply sets the timezone so the warning about not having the timezone set isn't included in the list of errors.  <code>--standard=PHPCompatibility</code> is how we tell PHPCS which standard we want to evaluate against.  <code>--runtime-set testVersion 7.0</code> is how we tell PHPCompability which version of PHP we want to test against.</p><p>If you get nothing back after running the command, congratulations! Your code should be compatible with 7.0 (though as I said yesterday, I'd test against a couple of these tools just to make sure nothing is missed).  Using the same example code from yesterday, PHPCompatibility reported the following:</p><code>
FILE: ...foo.missouri.edu/www/wp-content/plugins/mizzoumvc/css/style.css
--------------------------------------------------------------------
FOUND 0 ERRORS AND 1 WARNING AFFECTING 1 LINE
--------------------------------------------------------------------
1 | WARNING | File appears to be minified and cannot be processed
--------------------------------------------------------------------</code><p>Time: 14.16 secs; Memory: 36.25Mb</p><p>Given this report and that the issues identified by php7cc and php7mar yesterday were all false-positives, I'm fairly confident this <em>particular</em> codebase is ready for the migration, and I can move on to the next codebase.</p><p>Hopefully, one if not all three of these tools will help you in prepping for this migration.  As always, if you have any questions or run into any issues and need help, <strong>do not hesitate to reach out to me.</strong>  As I have mentioned previously, we want this migration to go as smoothly and transparently as humanly possible and will do whatever we can to make that happen.</p></body>
</html>
